name: ĞœĞ¾Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ CI

# ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ
on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Run workflow" Ğ² GitHub

jobs:
  # Job 1: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ°
  check-code:
    name: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ°
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ´ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
        uses: actions/checkout@v4
      
      - name: ğŸ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ
        run: |
          echo "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ FastAPI Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ..."
          timeout 5s uvicorn main:app --host 0.0.0.0 --port 8000 || true
          echo "âœ… ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚!"
  
  # Job 2: Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Docker Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
  build-docker:
    name: Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Docker
    runs-on: ubuntu-latest
    needs: check-code  # Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»Ğµ check-code
    
    steps:
      - name: ğŸ“¥ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ´
        uses: actions/checkout@v4
      
      - name: ğŸ³ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·
        run: |
          docker build -t todolist-api:latest .
          echo "âœ… Docker Ğ¾Ğ±Ñ€Ğ°Ğ· ÑĞ¾Ğ±Ñ€Ğ°Ğ½!"
      
      - name: ğŸ“‹ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ¾Ğ±Ñ€Ğ°Ğ·Ğµ
        run: |
          docker images | grep todolist-api
  
  # Job 3: Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
  success:
    name: Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!
    runs-on: ubuntu-latest
    needs: [check-code, build-docker]
    
    steps:
      - name: ğŸ‰ Ğ£ÑĞ¿ĞµÑ…!
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ñ‹!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Ğ§Ñ‚Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾:"
          echo "  âœ“ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½ ĞºĞ¾Ğ´"
          echo "  âœ“ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·"
          echo ""
          echo "Ğ’Ğ°Ñˆ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ CI Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚! ğŸš€"

